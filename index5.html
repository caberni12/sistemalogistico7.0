<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Capturador de Datos</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>

<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<audio id="beepQR" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="beepEAN" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<div class="wrap">
<div class="card">

  <!-- ================= TABBAR ================= -->
  <div class="tabbar">
    <button class="primary" onclick="openTab('captura')">ğŸ“‹ Capturador</button>
    <button class="primary" onclick="openTab('importar')">ğŸ“¥ Importar Maestra</button>
    <button type="button" class="primary" onclick="abrirModalConsulta()">ğŸ” Consultar</button>
  </div>

  <!-- ================= CAPTURADOR ================= -->
  <div id="captura" class="tab active">

    <h2>ğŸ“‹ Capturador PRO</h2>

    <div class="total" id="totalizador">Total unidades: 0</div>

    <input id="operador"
           placeholder="Nombre del operador"
           oninput="previewIngreso()">

    <!-- ===== UBICACIÃ“N ===== -->
    <div class="input-scan">
      <input id="ubicacion"
             placeholder="UbicaciÃ³n (opcional)"
             onfocus="activarScan('ubicacion')"
             oninput="previewIngreso()">
      <span class="icon">ğŸ“</span>
    </div>

    <div class="note">â„¹ï¸ La ubicaciÃ³n es opcional</div>

    <!-- SLOT SCANNER UBICACIÃ“N (VACÃO) -->
    <div id="scanner-ubicacion" class="scanner-slot"></div>

    <!-- ===== CÃ“DIGO ===== -->
    <div class="input-scan">
      <input id="codigo"
             type="text"
             placeholder="CÃ³digo"
             onfocus="activarScan('codigo')"
             oninput="buscarDescripcion();previewIngreso()">
      <span class="icon">ğŸ“·</span>
    </div>

    <!-- SLOT SCANNER CÃ“DIGO (VACÃO) -->
    <div id="scanner-codigo" class="scanner-slot"></div>

    <input id="descripcion"
           placeholder="DescripciÃ³n"
           oninput="previewIngreso()">

    <input id="cantidad"
           type="number"
           value="1"
           oninput="previewIngreso()">

    <div id="preview"></div>

    <button class="primary" onclick="ingresar()">ğŸ’¾ Guardar</button>
    <button class="warn" onclick="cancelarEdicion()">â†©ï¸ Cancelar ediciÃ³n</button>

    <div id="tabla"></div>

    <button class="success" onclick="finalizar()">ğŸ“Š Finalizar</button>
    <button class="primary" onclick="exportarPDF()">ğŸ“„ Descargar PDF</button>

  </div>

  <!-- ================= IMPORTADOR ================= -->
  <div id="importar" class="tab">

    <h2>ğŸ“¥ Importar Maestra de CÃ³digos</h2>

    <input type="file" id="fileExcel" accept=".xlsx">

    <div class="progress">
      <div id="barra"></div>
    </div>

    <button class="primary" onclick="importarMaestra()">â¬†ï¸ Importar a Google Sheets</button>

    <div id="mensaje" class="msg"></div>

  </div>

</div>
</div>

<!-- ================= MODAL CONSULTA ================= -->
<div id="modalConsulta" class="modal">
  <div class="modal-card">

    <div class="modal-header">
      <b>ğŸ” Consulta de productos</b>
      <button onclick="cerrarModalConsulta()">âœ–</button>
    </div>

    <input id="buscarConsulta"
           placeholder="Buscar por cÃ³digo o descripciÃ³nâ€¦"
           oninput="filtrarConsulta()">

    <button class="primary" onclick="exportarMaestraProductos()">
      ğŸ“¤ Exportar Maestra de Productos
    </button>

    <div class="table-scroll" id="scrollConsulta" style="display:none">
      <table id="tablaConsulta">
        <thead>
          <tr>
            <th>CÃ³digo</th>
            <th>DescripciÃ³n</th>
          </tr>
        </thead>
        <tbody id="resultadoConsulta"></tbody>
      </table>
    </div>

    <div id="msgConsulta" class="msg">Escriba para consultar</div>

  </div>
</div>

<script src="pro.js"></script>
<script src="auth.js"></script>
</body>
</html>
